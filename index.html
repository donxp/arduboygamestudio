<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="app/app.css">
    <link rel="stylesheet" href="static/css/bootstrap.min.css">
    <script>
      require("google-closure-library");
    </script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"></script>
    <!---  <script src="blockly_compressed.js"></script>
      <script src="javascript_compressed.js"></script> -->
  </head>
  <body style="margin-top: 2px; margin-left: 2px;">
    <div id="app" class="container-fluid m-0 p-0">
      <div style="display: flex; justify-content: space-between">
        <div class="project-actions">
          <!-- <button class="btn btn-sm btn-primary" onClick="newProject()">New</button>
          <button class="btn btn-sm btn-primary" onClick="loadProject()">Open</button>
          <button class="btn btn-sm btn-primary" onClick="saveProject()">Save</button>
          <button class="btn btn-sm btn-primary" onClick="newProject()">Ver</button>
          <button class="btn btn-sm btn-primary" onClick="newProject()">Upload</button> -->
          <project-actions @project-loaded="projectLoaded"></project-actions>
          

          <button @click="showPreferences">Show pref</button>
        </div>
        <div>
          <button class="btn btn-sm btn-warning" @click="toggleShowSpriteContainer">Sprites</button>
        </div>
      </div>
      <!-- <b>Tabs:</b>
      <div class="project-tabs">
        <div class="tab" id="main">main</div> 
        <div class="tabadd" id="tabAddition">+</div>
      </div> -->
      <tabs ref="tabs" v-if="workspaceLoaded"></tabs r>

      <!-- Preferences opens-->
      <preferences ref="preferencesModal" v-if="workspaceLoaded"></preferences>
      

      <xml id="toolbox" style="display: none">
        <category name="Control">
            <block type="controls_if"></block>
            <block type="controls_repeat_ext"></block>
        </category>
        <category name="Logic">
            <block type="logic_compare"></block>
            <block type="checkforbuttonpress"></block>
            <block type="incrementx"></block>
            <block type="incrementy"></block>
            <block type="is_colliding_with"></block>
            <block type="gamestart"></block>
            <block type="changexpos"></block>
            <block type="changeypos"></block>
            <block type="playnotes3"></block>
            <block type="playnotes2"></block>
            <block type="playnote"></block>
            <block type="note"></block>
            <block type="wait"></block>
            
        </category>
        <category name="Math">
            <block type="math_number"></block>
            <block type="math_arithmetic"></block>
            <block type="randomrange"></block>
        </category>
        <category name="Text">
            <block type="text"></block>
            <block type="text_print"></block>
            <block type="string_length"></block>
            
        </category>
        <category name="Variables" custom="VARIABLE"></category>
      </xml>
      <div class="row w-100">
        <div class="col">
          <section style="position: relative;width: 100%; height: 300px;">
            <div id="blocklyDiv" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0"></div>
          </section>
        </div>
        <div id="sprite-container" class="col-sm-4" v-if="showSpriteContainer">
          <div class="card">
            <div class="card-body p-2">
                <button class="btn btn-sm btn-success" @click="addSprite">Add new</button>
                <hr class="mt-3 mb-4">
                <div class="sprite" v-for="(item, index) in sprites">
                  <div class="row">
                    <div class="col">{{ item.name }}</div>
                    <div class="col-3 pr-1"><button class="btn btn-sm btn-warning btn-block">Rename</button></div>
                    <div class="col-3 pl-1"><button class="btn btn-sm btn-danger btn-block">Remove</button></div>
                  </div>
                </div>
              </div>
          </div>
        </div>
      </div>
      
      <!-- Fix blockly container hogging area -->
      <div style="margin-top: 45px;"></div>
      <textarea name="code" id="code" cols="50" rows="20"></textarea>
      <textarea name="theP" id="theP" cols="50" rows="20"></textarea>
      <button id="myBtn">Try it</button>
      <p id="demo"></p>
      <div id="sprite-creator-modal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Sprite creator</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-sm-3 offset-sm-3">
                    Sprite width: {{ spriteCreatorWidth }}
                    <input v-model="spriteCreatorWidth" min="0" max="64" type="range">
                </div>
                <div class="col-sm-3">
                    Sprite height: {{ spriteCreatorHeight }}
                    <input v-model="spriteCreatorHeight" min="0" step="8" max="64" type="range">
                </div>
              </div>
              <canvas ref="spriteCreator" width="766" height="766" @click="spriteCreatorCanvasClick($event)"></canvas>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" @click="spriteCreatorSave">Save</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>

    </div>

    <button onclick="myFunction()">Click me</button>

      <p id="demo2"></p>

<script>
function myFunction() {
  Blockly.Arduino.showMeTheCode();
}
</script>
    
    <script>
      document.getElementById("myBtn").addEventListener("click", function(){
      document.getElementById("demo").innerHTML = "Hello World";
      });
      function myUpdateFunction(event) {
       // var code = Blockly.JavaScript.workspaceToCode(workspace);
      //  document.getElementById('textarea').value = code;
    }
    workspace.addChangeListener(myUpdateFunction);


      //var code = Blockly.Arduino.workspaceToCode(workspace);
    //  document.getElementById("demo").innerHTML = code;
    </script>
   
    <script src="./static/js/jquery.js"></script>
    <script src="./node_modules/vue/dist/vue.min.js"></script>
    <script src="./app/app.js"></script>
    <script src="./app/blocks.js"></script>
    <script src="./app/vue-app.js"></script>
    <script src="./app/generators/arduino.js"></script>
    <script src="./app/generators/arduino/boards.js"></script>
    <script src="./app/generators/arduino/colour.js"></script>
    <script src="./app/generators/arduino/io.js"></script>
    <script src="./app/generators/arduino/lists.js"></script>
    <script src="./app/generators/arduino/logic.js"></script>
    <script src="./app/generators/arduino/loops.js"></script>
    <script src="./app/generators/arduino/map.js"></script>
    <script src="./app/generators/arduino/math.js"></script>
    <script src="./app/generators/arduino/procedures.js"></script>
    <script src="./app/generators/arduino/serial.js"></script>
    <script src="./app/generators/arduino/servo.js"></script>
    <script src="./app/generators/arduino/spi.js"></script>
    <script src="./app/generators/arduino/text.js"></script>
    <script src="./app/generators/arduino/time.js"></script>
    <script src="./app/generators/arduino/variables.js"></script>
    <script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  </body>
</html>
